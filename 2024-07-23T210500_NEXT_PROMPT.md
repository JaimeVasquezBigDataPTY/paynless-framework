# NEXT STEPS for Paynless Anonymous Chat

**Goal:** Securely enable anonymous users to use the AI chat on the Home page with default selections, while maintaining security for authenticated users and preventing direct API abuse.

**Current State:**
- `supabase/config.toml` updated: `[functions.chat]` section added with `verify_jwt = false`.
- Security approach decided: Use a dedicated secret header (`X-Paynless-Anon-Secret`) for anonymous verification within the Edge Function.
- Detailed plan defined (see conversation history).

**Action Required from USER:**
1. Generate a strong, random string for the `ANON_FUNCTION_SECRET`.
2. Inform the AI assistant once the secret is generated (DO NOT SHARE THE SECRET ITSELF).

**Next Actions for AI (After User Confirms Secret Generation):**
1.  **Modify `supabase/functions/chat/index.ts`:** Implement secret header check, JWT verification logic, and IP-based rate limiting.
2.  **Modify `packages/api-client/src/ai.api.ts`:** Update fetch utility to pass custom headers.
3.  **Modify `packages/store/src/aiStore.ts`:** Add logic in `sendMessage` to include the `X-Paynless-Anon-Secret` header (read from `import.meta.env.VITE_ANON_FUNCTION_SECRET`) for anonymous requests.
4.  **Modify `apps/web/src/pages/Home.tsx`:** Implement the `useEffect` hook to set default provider/prompt selections.

**Subsequent User Actions:**
- Set environment variables (`.env` and Supabase secrets).
- Update/write unit tests for the Edge Function.
- Update/write integration/E2E tests.
- Deploy. 